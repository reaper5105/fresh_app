{% extends 'base.html' %}

{% block title %}{{ profile_user.username }}'s Profile{% endblock %}

{% block content %}
<!-- Public Profile Header -->
<div class="bg-white p-8 rounded-2xl shadow-lg mb-10 text-center">
    <h2 class="text-4xl font-bold text-primary">
        {{ profile_user.username }}'s Profile
    </h2>
    
    <!-- Show follow/unfollow button if the viewer is logged in and not viewing their own profile -->
    {% if user.is_authenticated and user != profile_user %}
        <div class="mt-4">
            <a href="{% url 'follow_user' profile_user.id %}" class="btn-primary">
                {% if profile_user.userprofile in user.userprofile.follows.all %}
                    Unfollow
                {% else %}
                    Follow
                {% endif %}
            </a>
        </div>
    {% endif %}
</div>

<!-- Contributions by this user -->
<h3 class="text-3xl font-bold text-primary mb-6">{{ profile_user.username }}'s Posts</h3>
<div class="space-y-8">
    {% for item in user_contributions %}
    <div class="bg-white p-6 rounded-2xl shadow-lg">
        <p class="text-xl font-bold">
            <span class="text-secondary">{{ item.get_category_display }}</span> from <span class="text-primary">{{ item.state.name }}</span>
        </p>
        <p class="text-sm text-gray-500 mb-4">Posted on {{ item.submitted_at|date:"F j, Y" }}</p>
        
        {% if item.text_content %}<p class="mb-4">{{ item.text_content }}</p>{% endif %}
        
        <div class="flex flex-wrap gap-4">
            {% if item.image_content %}<img src="{{ item.image_content.url }}" class="max-w-sm rounded-lg">{% endif %}
            {% if item.video_content %}<video controls src="{{ item.video_content.url }}" class="max-w-sm rounded-lg"></video>{% endif %}
            {% if item.audio_content %}<audio controls src="{{ item.audio_content.url }}"></audio>{% endif %}
        </div>
    </div>
    {% empty %}
    <p class="text-center text-gray-500 py-8">{{ profile_user.username }} has not made any contributions yet.</p>
    {% endfor %}
</div>
{% endblock %}
